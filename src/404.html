<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Git Proxy</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
    <style>
      * {
        box-sizing: border-box;
      }

      html {
        height: 100%;
        font-family: 'Inter', sans-serif;
        font-optical-sizing: auto;
        font-style: normal;
        font-variation-settings: 'slnt' 0;
      }

      body {
        min-height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <h1>You haven't visited this web page before, let's get you set up!</h1>
    <script type="module">
      // If we already have a controller, we can redirect immediately
      if (navigator.serviceWorker.controller) {
        console.log('Service worker is already controlling the page');
      } else {
        // Otherwise wait for a controller
        console.log('Waiting for service worker to take control...');
        try {
          const registration = await navigator.serviceWorker.register('./service-worker.js', { type: 'module' });
          console.log(`service worker status: ${registration.installing}`);
        } catch (error) {
          console.log('ServiceWorker registration failed: ', error);
          document.body.innerHTML = `
<h1>The git service worker proxy failed to load.</h1>
<p>If you're on Firefox, check this <a href="https://caniuse.com/mdn-api_serviceworker_ecmascript_modules">link</a> for more information and if Firefox is green now, <a href="mailto:pvh@pvh.ca">email me</a>.</p>`;
        }
      }
    </script>
  </body>
</html>
